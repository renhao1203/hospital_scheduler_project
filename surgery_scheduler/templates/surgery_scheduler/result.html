{% load static %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<div class="header-banner" style="display: flex; justify-content: space-between; align-items: center; padding: 10px 40px;">
    <div>
        <h1 style="margin:0;">ğŸ“Š æ‰‹è¡“å®¤æŒ‡æ®ä¸­å¿ƒ - æ™ºæ…§å„ªåŒ–çœ‹æ¿</h1>
        <p style="margin:0; opacity: 0.9;">æ•ˆèƒ½æå‡ï¼š{{ optimized.utilization_improvement }}% | é‚è¼¯ï¼š4å°æ™‚ç©ºæª”è·¨æˆ¿å¡«è£œ</p>
    </div>
    <div style="display: flex; gap: 10px;">
        <a href="{% url 'upload' %}" class="btn-medical" style="background: rgba(255,255,255,0.2); color: white; text-decoration: none; border: 1px solid white;">ğŸ  å›é¦–é </a>
        <button onclick="window.print()" class="btn-medical" style="background: white; color: #4f46e5; border: none;">ğŸ“¥ åŒ¯å‡ºæ›´æ–°æ’ç¨‹</button>
    </div>
</div>

<div class="container" style="max-width: 1300px; margin: auto; padding: 20px;">
    {% if not rooms_data %}
        <div class="glass-card" style="text-align: center; padding: 50px;">
            <h3>ç›®å‰å°šç„¡å„ªåŒ–æ’ç¨‹è³‡æ–™</h3>
            <p>è«‹å›é¦–é é‡æ–°ä¸Šå‚³æ‰‹è¡“å ±è¡¨ PDF</p>
            <a href="{% url 'upload' %}" class="btn-medical" style="text-decoration: none; display: inline-block; margin-top: 20px;">ğŸš€ å‰å¾€ä¸Šå‚³é é¢</a>
        </div>
    {% endif %}

    {% for room_no, data in rooms_data.items %}
    <div class="glass-card" style="border-top: 5px solid #4f46e5; margin-bottom: 30px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h2 style="color: #4f46e5; margin: 0;">ç¬¬ {{ room_no }} æ‰‹è¡“æˆ¿</h2>
            <div class="badge" style="background: #ecfdf5; color: #059669; font-size: 1rem; padding: 10px 15px;">
                â±ï¸ ç´¯è¨ˆå¡«è£œç©ºæª”ï¼š{{ data.total_saved }} åˆ†é˜
            </div>
        </div>
        <table class="surgery-table" style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="text-align: left; color: #64748b; font-size: 0.85rem; border-bottom: 2px solid #f1f5f9;">
                    <th style="padding: 12px;">å„ªåŒ–æ™‚æ®µ</th>
                    <th style="padding: 12px;">åŸå§‹å°ç…§</th>
                    <th style="padding: 12px;">ç—…æ‚£ / é†«å¸«</th>
                    <th style="padding: 12px;">æ‰‹è¡“æ³• (AI åˆ¤å®š)</th>
                    <th style="padding: 12px;">æ›´å‹•ç‹€æ…‹</th>
                </tr>
            </thead>
            <tbody>
                {% for s in data.surgeries %}
                <tr style="border-bottom: 1px solid #f1f5f9; {% if s.original_room != room_no %}background: #fff7ed;{% elif s.original_start_time != s.scheduled_start|date:'H:i' %}background: #f0f7ff;{% endif %}">
                    <td style="padding: 12px;"><b>{{ s.scheduled_start|date:"H:i" }}</b></td>
                    <td style="padding: 12px; color: #94a3b8; font-size: 0.85rem;">
                        {% if s.original_start_time %}
                            <span style="text-decoration: line-through;">{{ s.original_start_time }}</span><br>
                            {% if s.original_room != room_no %}
                                <b style="color: #ea580c;">åŸ: {{ s.original_room }} æˆ¿</b>
                            {% endif %}
                        {% endif %}
                    </td>
                    <td style="padding: 12px;">
                        <div style="font-weight: 700;">{{ s.patient_name }}</div>
                        <div style="font-size: 0.8rem; color: #64748b;">é†«å¸«: {{ s.doctor.name }}</div>
                    </td>
                    <td style="padding: 12px;">
                        <div style="font-size: 0.9rem;">{{ s.surgery_type|truncatechars:35 }}</div>
                        {% if s.estimated_duration <= 120 %}
                            <span style="font-size: 0.7rem; color: #059669; background: #f0fdf4; padding: 2px 6px; border-radius: 4px;">AI: å°æ‰‹è¡“</span>
                        {% else %}
                            <span style="font-size: 0.7rem; color: #b91c1c; background: #fef2f2; padding: 2px 6px; border-radius: 4px;">AI: å¤§æ‰‹è¡“</span>
                        {% endif %}
                    </td>
                    <td style="padding: 12px;">
                        {% if s.original_room != room_no %}
                            <span class="badge" style="background: #ea580c; color: white;">ğŸ”„ è·¨æˆ¿æŒªç§»</span>
                        {% elif s.original_start_time != s.scheduled_start|date:'H:i' %}
                            <span class="badge" style="background: #4338ca; color: white;">ğŸš€ æ™ºæ…§éè£œ</span>
                        {% else %}
                            <span class="badge" style="background: #f1f5f9; color: #64748b;">éŒ¨é»å›ºå®š</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endfor %}
    
    <div style="text-align: center; margin: 40px 0;">
        <a href="{% url 'upload' %}" class="btn-medical" style="text-decoration: none; background: #64748b; padding: 12px 30px;">ğŸ  è¿”å›æ’ç¨‹ä¸Šå‚³é é¢</a>
    </div>
</div>
